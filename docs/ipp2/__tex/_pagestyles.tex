% Trailing %s are used to prevent rogue whitespace at the start of the document%

\widenhead{0pt}{\dimexpr\marginparsep+\marginparwidth}%
\settitlemarks{section,subsection}%

\newpagestyle{titlepage}{%
  \sethead{}{}{}%
  \setfoot{}{}{}%
}% titlepage style

\newpagestyle{contents}%
  [\normalfont\sffamily\small\addfontfeatures{Numbers={OldStyle,Proportional}}]%
  {%
  \sethead%
  {\smash{\makebox[0pt][l]{\rule[-.3\baselineskip]{\entireTextWidth}{0.4pt}}}\toptitlemarks\sectiontitle}%
  {}%
  {\thepage}%
  \setfoot{}{}{}%
}% contents style

\newpagestyle{mainmatter}%
  [\normalfont\sffamily\small\addfontfeatures{Numbers={OldStyle,Proportional}}]%
  {%
  \sethead%
  {\smash{\makebox[0pt][l]{\rule[-.3\baselineskip]{\entireTextWidth}{0.4pt}}}{\addfontfeatures{Numbers={Lining,Proportional}}\firsttitlemarks\S\thesection}\enskip\firsttitlemarks\sectiontitle\bottitlemarks\ifsamemark\firsttitlemarks\thesection{}{\ -- {\addfontfeatures{Numbers={Lining,Proportional}}\S\thesection}\enskip\bottitlemarks\sectiontitle}
  }%
  {}%
  {\thepage}%
  \setfoot{}{}{}%
}% mainmatter style

\newpagestyle{backmatter}{%
  \sethead{}{}{}%
  \setfoot{}{}{}%
}% backmatter style
